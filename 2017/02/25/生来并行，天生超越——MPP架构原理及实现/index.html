<!DOCTYPE html>
<html>
    <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Title -->
    
    <title>
        生来并行，天生超越——MPP架构原理及实现 | instore.top | Learn More, Share More.
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.ico">
    <link rel="icon" sizes="192x192" href="/img/favicon.ico">
    <link rel="apple-touch-icon" href="/img/favicon.ico">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Liang3p">
    <meta name="description" content="Learn More, Share More.--We are not exactly sure what is in store for us, but we know that sharing ideas keeps us moving on. I wish everyone have the big surprise InStore.">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="instore.top | Learn More, Share More.">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://instore.top">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="生来并行，天生超越——MPP架构原理及实现 | instore.top | Learn More, Share More.">
    <meta property="og:description" content="Learn More, Share More.--We are not exactly sure what is in store for us, but we know that sharing ideas keeps us moving on. I wish everyone have the big surprise InStore.">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/solarized-white.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#序"><span class="post-toc-number">1.</span> <span class="post-toc-text">序</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#多维并行能力"><span class="post-toc-number">2.</span> <span class="post-toc-text">多维并行能力</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查询并行的类型"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">查询并行的类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#跨越AMP并行执行"><span class="post-toc-number">2.1.1.</span> <span class="post-toc-text">跨越AMP并行执行</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#单步并行"><span class="post-toc-number">2.1.2.</span> <span class="post-toc-text">单步并行</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#多步并行"><span class="post-toc-number">2.1.3.</span> <span class="post-toc-text">多步并行</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#多语句的请求"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">多语句的请求</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#演化特性"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">演化特性</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#并行感知优化器"><span class="post-toc-number">3.</span> <span class="post-toc-text">并行感知优化器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#关联计划"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">关联计划</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#估量环境"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">估量环境</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#以并行的方式思考"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">以并行的方式思考</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#隐藏复杂性"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">隐藏复杂性</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#演化特性-1"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">演化特性</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#BYNET的巨大贡献"><span class="post-toc-number">4.</span> <span class="post-toc-text">BYNET的巨大贡献</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#消息传递"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">消息传递</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更进一步的性能提升"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">更进一步的性能提升</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#动态BYNET组"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">动态BYNET组</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#信号系统"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">信号系统</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#最终结果集排序-合并"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">最终结果集排序/合并</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#演化特性-2"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">演化特性</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一种灵活，快速的方式来查找和存储数据"><span class="post-toc-number">5.</span> <span class="post-toc-text">一种灵活，快速的方式来查找和存储数据</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数据如何组织"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">数据如何组织</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#主人索引"><span class="post-toc-number">5.1.1.</span> <span class="post-toc-text">主人索引</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#柱面索引"><span class="post-toc-number">5.1.2.</span> <span class="post-toc-text">柱面索引</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据块"><span class="post-toc-number">5.1.3.</span> <span class="post-toc-text">数据块</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#轻松适应数据增长"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">轻松适应数据增长</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#使用逻辑寻址的表扫描效率"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">使用逻辑寻址的表扫描效率</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#后台清理任务"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">后台清理任务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#演化特性-3"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">演化特性</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自动调节工作流"><span class="post-toc-number">6.</span> <span class="post-toc-text">自动调节工作流</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#AMP级控制"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">AMP级控制</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#将到达消息放入队列"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">将到达消息放入队列</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AMP工作任务"><span class="post-toc-number">6.2.1.</span> <span class="post-toc-text">AMP工作任务</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#消息队列"><span class="post-toc-number">6.2.2.</span> <span class="post-toc-text">消息队列</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#拒绝新消息"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">拒绝新消息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#流量控制闸门"><span class="post-toc-number">6.3.1.</span> <span class="post-toc-text">流量控制闸门</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#恢复正常"><span class="post-toc-number">6.3.2.</span> <span class="post-toc-text">恢复正常</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#驾驭满负荷"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">驾驭满负荷</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工作负载管理"><span class="post-toc-number">7.</span> <span class="post-toc-text">工作负载管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原始的四个优先事项"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">原始的四个优先事项</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#混合工作量的影响"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">混合工作量的影响</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#工作负载管理的演变"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">工作负载管理的演变</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#总结"><span class="post-toc-number">8.</span> <span class="post-toc-text">总结</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->


<!-- header_home -->

<!-- header_home -->
<div class="material-index mdl-grid" style="margin-top: -145px;padding-left: 10px;padding-bottom: 80px;">
    <a href="/">
        <img src="/img/instore.top.png" alt="logo" />
    </a>
</div>


    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            生来并行，天生超越——MPP架构原理及实现
        </p>
    </div>

	


				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Liang3p</strong>
        <span>2月 25, 2017</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/MPP/">MPP</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Teradata/">Teradata</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/翻译/">翻译</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=生来并行，天生超越——MPP架构原理及实现&url=http://instore.top//2017/02/25/生来并行，天生超越——MPP架构原理及实现/index.html&via=Liang3p" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://instore.top//2017/02/25/生来并行，天生超越——MPP架构原理及实现/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=生来并行，天生超越——MPP架构原理及实现&url=http://instore.top//2017/02/25/生来并行，天生超越——MPP架构原理及实现/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<p>这篇文章将带你深入探讨MPP架构核心计算引擎的原理和实现。文章来源于Teradata技术白皮书《<a href="http://assets.teradata.com/resourceCenter/downloads/WhitePapers/EB3053_new.pdf" target="_blank" rel="external">Born to be Parallel, and Beyond</a>》，是<em>Born to be Paralle</em>系列白皮书的最新版本，感兴趣的话可以查看这个<a href="http://fmsi.biz/transparency/documents/Teradata/Born_to_be_Parrallel.pdf" target="_blank" rel="external">历史版本</a>，这是博主读过的第一个版本。<br>为便于更多读者阅读，博主对原文做了中文翻译。转载请注明<a href="http://instore.top/2017/02/25/%E7%94%9F%E6%9D%A5%E5%B9%B6%E8%A1%8C%EF%BC%8C%E5%A4%A9%E7%94%9F%E8%B6%85%E8%B6%8A%E2%80%94%E2%80%94MPP%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/">原文地址</a>。</p>
<blockquote>
<p><strong>标题：生来并行，天生超越——Teradata持久的性能优势</strong><br><strong>原文标题：Born to be Parallel, and Beyond——Teradata’s Enduring Performance Advantage</strong></p>
</blockquote>
<h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>近期当你听到Teradata数据库时，通常都是在强调已经实现的，高度可见的特性，如Teradata QueryGrid或统一数据架构(UDA,Unified Data Architecture)。本文带你退一步的时间，回到80年代初，当Teradata数据库首次出现启动的那天。把注意力集中在一个新的并行数据库上的原始基础和关键特性上。</p>
<p>最初构建的基本模块仍然保持在原位，他们不断提升和扩展Teradata数据库的主要优势直到今天。Teradata数据库惊人的持久的的性能优势是这些早期的就由少数富有创造力的架构师的一些非常规的设计决策的直接结果。</p>
<p>本文介绍和说明了Teradata数据库关键的基础组件及其当下的新特性和剩余的能力。这些基础组件的性能表现无论是对于当时还是现在都至关重要的。</p>
<p>本文将讨论这些特定范围:</p>
<ul>
<li>多维并行能力</li>
<li>查询优化器功能</li>
<li>BYNET的巨大贡献</li>
<li>一个灵活、快捷的方法来查找和存储数据</li>
<li>管理工作流和工作负载管理</li>
</ul>
<p>这个白皮书的范围仅限于重要,基础数据库的组件。这不是一个全面的讨论Teradata数据库的所有方面的文档。</p>
<p>此外还有几个多年来在基础上的重要的功能,但这不在本文的讨论范围。它们包括用户定义函数,表操作,数据类型如XML、JSON/BSON/UBJSON半结构化数据的处理、地理空间,列存储,临时表,Teradata智能内存和内存优化。</p>
<h2 id="多维并行能力"><a href="#多维并行能力" class="headerlink" title="多维并行能力"></a>多维并行能力</h2><p>在1970年代后期的Teradata数据库是当时第一个在商业上可用的基于SQL从基础设计到支持用户业务查询都支持并行处理的数据库产品。自那时以来，并行处理已成为任何严谨的数据库必要支持的特性，因为数据分析的需求继续推动更高的容量，更多的用户数量，更实时的性能。</p>
<p>基于消除单线程操作的设计目标,最初的架构师从SQL语句入口到语句执行的最小细节并行化了Teradata数据库所有内容。整个数据库的基础都是围绕着每个组件在系统中并行构建的许多看起来相似的组件。不知道未来的瓶颈会在何处涌现,早期开发者淘汰所有可能的单点控制,有效地消除了系统中会导致僵局的条件。</p>
<p>Teradata支持无限互连通路、多个优化器、主机通道连接、网关和并行单元，增加灵活性和控制性能，是今天的大规模数据分析的关键。</p>
<p>Teradata并行的基本单位是AMP(Access Module Processor,访问模块处理器),一个虚拟处理单元管理所有数据库操作的部分一个表的数据。一个给定的节点通常会配置许多个AMP。每个节点从20到40或多个AMP在今天是很常见的。</p>
<p>一旦配置，数据加载、备份、索引生成，事实上一切都在Teradata系统发生的，分布在一个预先定义好数量的AMP上。并行性是可预测的和可理解的。</p>
<p>每个AMP的行为像数据库的一个缩影，支持对其拥有的数据进行诸如数据加载、读取、写入、日志和恢复操作（见图1）。并行单元之间互相了解，在幕后共同合作。这个团队之间的并行单元以最小的开销高性能驱动着是Teradata数据库的一个不寻常的力量。</p>
<h3 id="查询并行的类型"><a href="#查询并行的类型" class="headerlink" title="查询并行的类型"></a>查询并行的类型</h3><p>尽管AMP是并行处理的基本单位，此外仍然有两个额外的平行维度编织到Teradata数据库，特别是查询性能。这些被提到的两个维度就是单步并行（within-a-step）和多步并行（multi-step）。下面的部分描述了这三个维度的并行性：</p>
<h4 id="跨越AMP并行执行"><a href="#跨越AMP并行执行" class="headerlink" title="跨越AMP并行执行"></a>跨越AMP并行执行</h4><p>最知名的并行类型是跨越多个AMP的并行执行。这种并行包含多个分支，这些分支是由查询请求拆分而来的，每个分支同时工作，最后交付一个查询结果。并行执行可以在一个查询中包含全部或部分的操作,并能显著降低SQL语句的响应时间,特别是查询需要读取和分析大量的数据时。</p>
<p>在Teradata并行执行通常是将表数据在系统中定义的所有AMPs中进行哈希分布。一旦数据被分配给一个AMP,AMP就其分配到的数据块提供了所有的数据库服务.所有关系表扫描等操作,索引扫描、预测、选择、关联、聚合以及排序都是同时并行地执行在所有被分配数据块的AMP上。对AMP的数据块的每个操作与其他相关联的AMP数据块的操作是独立执行的。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715478.png" alt="图片1"></p>
<h4 id="单步并行"><a href="#单步并行" class="headerlink" title="单步并行"></a>单步并行</h4><p>第二维度的并行处理在执行重叠的选定的数据库操作时会自然地展开，这里称为单步并行(within-a-step)。优化器将一个SQL查询分为少数高级数据库操作称为“步骤”,将这些不同的步骤执行一个接一个分配到AMP上。</p>
<p>一步可以是一小片或一大块工作。它可以很简单，如“扫描一个表并返回结果”，或复杂的，如“扫描两个表和应用谓词,关联两个表,将指定列的关联结果重分布，对重分布数据行排序，并将重分布的数据写入一个中间表。”</p>
<p>在我们称之为步骤的这些潜在的大块工作中，可以通过流水线并行处理多个关系操作。当表扫描正在发生时，从扫描中选择的行可以立即流水线化为联接过程。流水线是在其前任务完成之前开始一项任务的能力，并将在每一个不同的步骤中尽可能地进行（见图2）。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715559.png" alt="图片2"></p>
<p>这种动态执行技术,第二个操作跳跃到第一个步骤与其并行执行,是增加基本查询并行性的关键。一个步骤的关系操作符组合是通过Teradata优化器避免流水线中断而精心挑选的。</p>
<h4 id="多步并行"><a href="#多步并行" class="headerlink" title="多步并行"></a>多步并行</h4><p>多步并行允许在系统中所有的并行单元对一个查询同时执行多个“步骤”。每个AMP上的每一步都要调用一个或多个任务来执行实际的数据库操作。同一查询的多个步骤可以在同一时间执行，它们不依赖于先前步骤的结果。图3是在查询执行过程中可能出现的所有这三种并行类型的实例。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715614.png" alt="图片3"></p>
<p>图中显示了四个AMP如何支持单个查询的执行，并将查询优化为7个步骤。步骤1.2和步骤2.2是单步并行（within-a-step）的实例，两个不同的表扫描和关联在一起（执行了三种不同的操作）。这三个操作的结果是将排序，然后重分布并入处理流程，全部都在一个步骤完成。步骤1.1和1.2一起（以及2.1和2.2一起）是多步并行（multi-step）的实例，被选择作为两个不同的步骤在每个AMP上在同时执行。</p>
<p>这多方面的并行不易编排，除非是在产品的早期演化阶段已经计划好的。优化器为一个查询生成三个维度的并行，如这里所描述的，必须熟悉所有可用的并行功能，知道如何以及何时使用它们。而最重要的是，Teradata数据库自动应用这些多维度的并行，无需用户干预或特殊的设置。</p>
<h3 id="多语句的请求"><a href="#多语句的请求" class="headerlink" title="多语句的请求"></a>多语句的请求</h3><p>除了如图3所示的三个维度的并行结构，Teradata数据库提供了一个SQL扩展名为多语句请求允许几个不同的SQL语句被捆绑在一起就如他们是一个单元发送到向优化器。Teradata数据库将尝试并行执行这些SQL语句，只要其中的语句不依赖。</p>
<p>使用此功能时，不同的子表达式中任何具有相同的SQL表达都将一次执行，并且执行的结果将被共享。所谓公共子表达式消除，意味着如果六个SELECT语句都被捆绑到一个单一的请求，以及所有包含相同的子查询，子查询只执行一次。尽管这些SQL语句是在一个相互依存、重复执行的方式，在多语句的请求中每个查询将返回各自不同的结果集（见图4）。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715659.png" alt="图片4"></p>
<h3 id="演化特性"><a href="#演化特性" class="headerlink" title="演化特性"></a>演化特性</h3><p>在过去的几年里，利用数据库中固有的并行性，许多功能已被添加到Teradata数据库。比如FastExport实用工具，在数据库所有AMP上并行地拉取大量数据。再例如已定义好的分析函数，复杂地窗口函数在并行地基础上执行，这些是小部分例子。</p>
<p>Teradata QueryGrid，最近的一个特性。它依赖Teradata数据库的并行性，从外部服务器访问数据行。QueryGrid的特性是提供了统一的接口将不同系统的数据结合起来（包括异构系统），减少数据重复的需要。</p>
<p>例如，你可以用QueryGrid从Teradata数据库的访问，过滤查询，并从Hadoop平台返回数据。然后你可以关联Teradata表数据和从Hadoop接入的数据，如果需要的话，都在一个单一的SQL语句完成。</p>
<p>当中等或大量数据正在从外部服务器访问时，Teradata数据库的并行性有助于QueryGrid的性能。多个来自Hadoop的数据流可以并行地直接连接，分配到剩余的不同的在Teradata配置的AMP中。每个AMP接收和缓存Hadoop的数据子集。所有的AMP并行工作时，输入和处理从Hadoop刚刚到达的数据，仿佛只是另一个查询的步骤的一部分。没有Teradata数据库原生的并行能力，加载外部服务器数据时，QueryGrid无法提供相同的效率水平。</p>
<h2 id="并行感知优化器"><a href="#并行感知优化器" class="headerlink" title="并行感知优化器"></a>并行感知优化器</h2><p>如果不谨慎应用于每个特定请求的需要，拥有一系列并行技术可能会变成一个劣势。想象这些组合的多个维度的并行的能力，Teradata数据库早期的架构师建造了完全符合这些选择的很聪明的并知道何时及如何应用查询优化器。</p>
<h3 id="关联计划"><a href="#关联计划" class="headerlink" title="关联计划"></a>关联计划</h3><p>当优化器开始创建一个查询计划的任务时，它的一个目标就是最大化这个特定工作的吞吐量。考虑一个查询，它必须访问六个表才能建立其结果集。优化器的工作之一是确定首先要访问和关联的表，以及哪些表在以后的计划中访问和加入。它还必须考虑使用哪种类型的关联来将两个表的行连起来，以及访问每个表（例如索引访问或表扫描）的方法。</p>
<p>一个建立在原有的Teradata优化器之上的独特的能力是同时访问和关联多个表的能力，构建一个宽或“繁茂”的查询计划，而不是一个连续的“一次执行一个关联”（one-join-at-a-time）的计划。以上这六个表讨论可以是一个严格的线性方式的关联：关联table1和table2，然后将结果表与table3关联，然后z再关联他们的结果表，依此类推。如图5所示。这将在较长时间内延长查询所需使用的资源，可能会影响查询耗时。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715704.png" alt="图片5"></p>
<p>Teradata优化器寻求表内它们之间的逻辑关系的查询，如图3的2.2步骤的条目和命令。它还可以与其他表子集独立地访问和连接。这些往往是执行并行执行的候选步骤。图5说明了在仅限于线性连接的计划中优化了六个表关联和一个具有执行并行关联的选择的差异。</p>
<h3 id="估量环境"><a href="#估量环境" class="headerlink" title="估量环境"></a>估量环境</h3><p>但是，了解并行本身的尺寸被发现是不够的，当它来创建一个在并行数据库适用于复杂的查询优化器时。早期优化架构师确保其他“环境”的因素同时考虑在计划建设中。</p>
<p>优化器知道AMP数和当前配置中的节点数。它将考察硬件的处理能力，并使用成本计算算法计算潜在计划的估计成本。把所有这些信息放在一起，优化器会根据预期的资源使用一些候选查询计划，然后选择最便宜的候选计划。最低成本计划是以最少的系统资源来执行的计划。这些最后的成本估计是体现在啰嗦的查询“解释”文本中供用户阅读。</p>
<p>优化器在创建计划时总是寻找的重要信息是统计数据：参与查询的表和列的数据统计数据。这个统计数据，以直方图形式存储在数据字典中，有助于确定最好的关联顺序，它有助于优化评估的关联结果数据集的大小。此信息用于选择实现关联的最佳方法。</p>
<h3 id="以并行的方式思考"><a href="#以并行的方式思考" class="headerlink" title="以并行的方式思考"></a>以并行的方式思考</h3><p>Teradata优化器出生在一个并行的世界。因为它是建立在一个无共享架构的顶部，它被迫用一个完全并行的思维定势思考。</p>
<p>例如，在完成一个复制表步骤之前，优化器会评估表将被复制到AMP的数量，估计会展开的行数，并考虑通过BYNET总的数据负载。然后，它给出了一个估计的成本，并比较其他可能涉及较少的移动数据或不同的连接顺序的替代方案。它的整个重点是提供一个查询计划，将一个用户提交的查询尽可能少的努力去执行。</p>
<h3 id="隐藏复杂性"><a href="#隐藏复杂性" class="headerlink" title="隐藏复杂性"></a>隐藏复杂性</h3><p>一个客户一直喜欢Teradata数据库的优化器的缘由是，它缓解了提交查询的用户不得不参与指导查询计划的问题。在幕后发生的优化和一个计划所有的影响，不是收集的统计数据得到的，而是从用户手中拿出来的。用户有完全自由去提交非常复杂的即席查询，或包含战术仪表板查询，或快速单行Look up查询，因为优化器将调整到任何扔在查询请求中的内容。</p>
<h3 id="演化特性-1"><a href="#演化特性-1" class="headerlink" title="演化特性"></a>演化特性</h3><p>多年的反馈和Teradata数据仓库的用户体验帮助开发者发现提升优化能力更好地满足现实需要的方式。在这种演变过程中，现有的组件往往以新的方式扩展或使用，而不需要从头开始或改变基础。例如Row-ID，被重新利用使得他们可以支持无主索引表和从原来的8个字节扩大为16字节以支持新的表分区的机会。</p>
<p>过去30年中，新的优化功能不断被加入到优化其中来，所有的功能都是在原始的基础上建设的。一些关键的特性包括：</p>
<ul>
<li>更复杂的统计收集选项，包括抽样、重新统计的阈值和跳过优化器启动统计收集。</li>
<li>运行时当统计信息过时时的统计推断。</li>
<li>将索引（实化视图）与由优化器管理的基础表同步连接。</li>
<li>新类型的连接，包括一个星形联接，在加入到一个事实表之前，首先汇集不相关的小表，并在内存哈希联接中利用在今天的大内存处理器上可能进行的内存处理。</li>
<li>增量计划和执行（IPE），在优化建立部分计划，执行第一个片段，然后根据第一片段的输出，建立并优化了第二片段和随后的片段。</li>
</ul>
<h2 id="BYNET的巨大贡献"><a href="#BYNET的巨大贡献" class="headerlink" title="BYNET的巨大贡献"></a>BYNET的巨大贡献</h2><p>Teradata数据库被设计为无共享的体系结构、硬件以及软件。AMPS和解析引擎（PE）彼此隔离工作。信息（Messages）是这些运动部件之间的通信手段，内部互连是把碎片拼起来的胶水，在所有这一切都在Teradata数据库高速运行的并行活动中（见图6）。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715744.png" alt="图片6"></p>
<p>从一开始，互连被视为设备传递消息的东西。相反，Teradata数据库设计广泛利用互连来提高性能并与数据库交互尽可能简化用户。由原来的Teradata提供的互连功能，称为YNet，生活在对单个节点的硬件和硬件驱动程序中。</p>
<p>YNet比标准的互连做的更多。今天使用的BYNET，继承了这些能力。不仅仅是传递信息，BYNET是一束智能和低层次的功能，为查询期间的几乎每一个点的高效处理提供帮助。它为每一个优化的查询步骤提供协调以及监督和控制。</p>
<blockquote>
<p>BYNET，“榕树网络”的缩写（BanYan NETwork），是一个建立在YNET的能力上折叠的榕树交换网络。它作为一个分布式的多层织物间的连接链路的解析引擎（PE），在大规模并行处理（MPP）系统AMPs和节点。<a href="http://lakshmikishore.blogspot.jp/2010/09/bynet.html" target="_blank" rel="external">原文链接</a><br>BYNET从榕树得名。榕树有能力不断地种植新的根，永远生长。同样，BYNET容纳了Teradata系统增长的规模。<a href="http://www.teradatawiki.net/2013/08/Teradata-BYNET.html" target="_blank" rel="external">原文链接</a></p>
</blockquote>
<p>本节探讨建立在YNET上并演化到当前BYNET与众不同的特性。这些原始的Ynet效益是揭幕原Teradata数据库必不可少的，并已被证明是今天同样不可或缺：</p>
<ul>
<li>消息传递：发送、优化和保证消息到达</li>
<li>多AMP协调：监视步骤完成和错误处理，当多个AMPS在同一个查询步骤上工作时</li>
<li>最终结果集排序：高效，在并行单元动态合并最终结果集，绕过昂贵的排序/合并例程</li>
<li>隔离：隔离数据库与详细配置信息，识别，调整及硬件故障</li>
<li>资源保护：提升信息交换效率<ul>
<li>识别和最小化参与接受自动态BYNET组给定的信息的AMP数量</li>
<li>缓冲区多个短消息到相同的AMP或节点，发送较少的长消息</li>
</ul>
</li>
<li>阻塞控制：对大批量的信息控制以防止超支或瓶颈</li>
</ul>
<p>以下部分提供了有关得益于BYNET性能的更详细的内容。</p>
<h3 id="消息传递"><a href="#消息传递" class="headerlink" title="消息传递"></a>消息传递</h3><p>BYNET的关键作用是支持解析引擎（PE）和AMPS以及多个AMP之间的通信。这种交流有多种形式，有些很直接。</p>
<ul>
<li>从调度模块上的PE到AMPS发送一个步骤以启动一个查询步骤</li>
<li>从一个AMP到另一个AMP重分布数据行以支持不同区域的关联</li>
<li>从多个AMP排序最终结果集</li>
</ul>
<p>这些简单的消息传递要求使用低级别的消息传递方法，绕过更重量级的通信协议。例如，发送一条消息从来都不需要在AMP和PE之间发起一个昂贵的TCP/IP连接。当需要进行数据行重分布或表复制时没有连接启动或拆卸的成本。只要进程行再分配或表复制需要发生。当数据行被重新分配或复制时，被发送的行不会一次一个地发送。而像合伙拼车的人，单个消息被捆绑，所以需要发送更少的消息。</p>
<p>尽管消息协议是低成本的，Teradata数据库通过最小化互连数量走了更近一步。相同的AMP，本地化的活动，被鼓励出现在任何可能的地方。基于AMP的数据所有权保持着活动，如锁定一些本地和AMP简单的数据处理。哈希分区支持将被关联的行托管减少数据传输。在全局信息传递之前，所有聚集首先被碾碎成在本地（AMP）级别的子集中最小可能集合。甚至当BYNET活动是未启动状态时，使用动态BYNET组（即原来的动态Ynet组）保持AMP必须交换信息的数量减少到最低限度。</p>
<h3 id="更进一步的性能提升"><a href="#更进一步的性能提升" class="headerlink" title="更进一步的性能提升"></a>更进一步的性能提升</h3><p>所有的或大部分的AMPS系统中需要相同的信息时，Teradata数据库经常在BYNET中使用广播，如对一个表的行复制，或为全部AMP发送调度消息以应用表级锁。但是当一个较小的AMP子集需要通信时，将考虑更便宜的点对点通信方案。</p>
<p>BYNET的点对点通信是类似于在公共电话网中的一个标准的电话通信。这些单呼线路连接一个发送节点到一个接收器节点。通常被称为非冲突的架构，这种方法最大限度地减少移动的数据总量开销。因为BYNET了解硬件配置和AMP的节点信息，可以通过为指向每一个AMP所在的每个物理节点只传递一条消息从而得到进一步的优化。这大大减少了消息发送次数，消除了系统中的每个AMP的接收、整理投递确认需求。</p>
<h3 id="动态BYNET组"><a href="#动态BYNET组" class="headerlink" title="动态BYNET组"></a>动态BYNET组</h3><p>动态BYNET组是将在场的工作在一个特定的查询步骤的AMP的简单的联合。许多这些BYNET组在任何时间点的存在，这是可能的。当一个查询已被优化，且第一步已经准备好了，一条消息将被自动通过BYNET发送，但只指向实际工作所需的AMP。这可能是系统中的所有AMP，或者它可能是一个子集，或只是一个。收到此步骤消息会导致AMP将自动加入BYNET组，无需数据库软件启动单独通信。</p>
<p>AMP功能上的组合是一个优化机会，即利用动态BYNET组的优势更好地服务查询策略。这个特性可以消除了一些全部AMP的步骤，并且以AMP的一个子集替换它们，当子集满足所有的查询要求时。这减少了这样的查询所需的资源,并释放了不必要的AMP，使其可以服务其他的工作,从而增加吞吐量。</p>
<h3 id="信号系统"><a href="#信号系统" class="headerlink" title="信号系统"></a>信号系统</h3><p>尽管BYNET采用消息传递保持轻量级的联系，它提供了一个更不易侵入的技术——通道（channels）——协调在幕后的inter-AMP执行查询的步骤。</p>
<p>当一个步骤开始执行，一个或多个通道将被建立，松散地联系执行步骤内动态BYNET组中所有AMP。通道利用监控和信号沟通参与的每AMP的成功/失败或者完成状态。信号是全局可用的并行架构的对象，因为他们生存在BYNET中。每一个完成的信号，包含这一步反映的计数,例如BYNET组的AMP是多么接近完成这一步，如图7所示。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715785.png" alt="图片7"></p>
<p>信号系统的职责是在组中的第一个AMP完成刚刚被处理的优化器步骤时发送信号，当组中的最后一个AMP完成相同步骤时也发送信号。这消除了每个AMP向调度程序发送消息的需要，也消除了当每个人都有回应时返回一堆代码来整理和计算的需要。</p>
<p>当AMP报告时，完成信号量的计数减1，并在最后一个AMP完成时减少到零。 当最终AMP完成它的工作，它看到信号量正在标记为零，它知道它是最后一个完成。因为它是完成此步骤的最后一个参与者，所以该AMP向调度程序发送消息以发出该查询的下一个优化步骤。这个“最后完成”的消息是关于该步骤发送回解析引擎的唯一实际消息，无论动态BYNET组是由三个还是3000个AMP组成。</p>
<p>某些查询无法完成。如果故障的原因限于单个AMP，则重要的是其他参与的AMP立即听到故障并停止对该查询的工作。如果在同一BYNET组中的AMP之间不存在紧密协调，则无问题AMP将继续在给定的查询步骤上工作，以非生产性方式吃掉资源。信号系统提供了如果一个需要报警则告警组中的所有AMP的方法，例如，如果一个AMP应当用尽Spool空间，或以其他方式终止该步骤，则使用BYNET上的信令代替消息传送。</p>
<p>若没有BYNET的能力来组合和整合来自所有并行单元的信息，每个AMP将不得不在系统中彼此独立地沟通正在进行的每个查询步骤。随着配置的增长，这种分布式协调查询工作的方法将迅速成为瓶颈。</p>
<h3 id="最终结果集排序-合并"><a href="#最终结果集排序-合并" class="headerlink" title="最终结果集排序/合并"></a>最终结果集排序/合并</h3><p>从来不需要在数据库内实质化查询的最终结果集一直是Teradata数据库的与众不同的特性。查询的最终排序/合并发生在BYNET中，因为结果集合行正在向客户端发送。</p>
<p>三个参与返回排序的结果集合的级别（参见图8）：</p>
<ul>
<li>级别1（AMP级别）：每个AMP与其他AMP并行执行本地排序，并为其一部分结果集创建缓冲文件。</li>
<li>级别2（节点级）：每个节点合并和排序来自所有其贡献的AMP的一个缓冲器的数据。</li>
<li>级别3（PE级别）：PE接收和排序节点级缓冲区，构建一个缓冲区的排序数据以返回到客户端。</li>
</ul>
<p>最高值首先通过3层发送，而结果集中包含较低值的部分将保留在AMP级别的缓冲文件中，直到客户端返回较高的值。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715826.png" alt="图片8"></p>
<p>在此过程中，执行的物理I/O最少。对于给定的行，只执行一次写入AMP的缓冲表。并且只需要同一行的一次读取-以正确的顺序检索用户的数据。</p>
<p>这种方法的一个很大的好处是，最终结果集不必集中在一个位置给一个可能很大表做最终排序。反之，结果集被最终并且一次将其返回到客户端缓冲器。潜在的“大排序”惩罚已经消除;或实际上，它从来不存在。</p>
<h3 id="演化特性-2"><a href="#演化特性-2" class="headerlink" title="演化特性"></a>演化特性</h3><p>YNet互连的原始架构很容易演变成当前的BYNET，就像它一样，它经历了几个转换。BYNET带来更大的可用性和可靠性，支持多个虚拟广播树和多个路径。</p>
<p>最近对BYNET功能的增强包括：</p>
<ul>
<li>将Ynet硬件功能转换为软件功能：虚拟化BYNET允许Teradata数据库在任何时间点接受任何最佳通用互连功能。</li>
<li>将BYNET硬件移动到软件中允许透明且一致的AMP间通信，使得同一节点上的AMP可以彼此联系，而不用经过互连，从而减少延迟和业务拥塞。</li>
<li>支持共享同一网络基础架构的多个Teradata系统，通过专用分区隔离系统内通信。</li>
</ul>
<h2 id="一种灵活，快速的方式来查找和存储数据"><a href="#一种灵活，快速的方式来查找和存储数据" class="headerlink" title="一种灵活，快速的方式来查找和存储数据"></a>一种灵活，快速的方式来查找和存储数据</h2><p>前面的章节讨论了Teradata数据库在并行性，优化器和BYNET方面的原始功能。 Teradata数据库持久性能背后的另一个非常重要的因素是如何管理空间。在数据库中定位行做了哪些努力？当插入一行并且它所属的数据块中没有空间时，会发生什么？</p>
<p>本节将重点介绍处理数据库空间管理的子系统的原始架构，称为“文件系统”的子系统。文件系统负责行的逻辑组织和管理，以及它们的可靠的存储和检索。</p>
<p>乍一看，管理空间看起来像一个简单的练习，机器人可以很容易地编程做。但是Teradata中的文件系统被设计为极其适应性，在外部简单，但在内部令人惊讶的创造性。它是从第一天设计的流动和开放的变化。文件系统的内置灵活性通过以下方式实现：</p>
<ul>
<li>逻辑寻址，允许在需要时将数据块动态切换到不同的物理位置，对活动工作的影响最小。</li>
<li>数据块根据需要随着表成熟而扩展和收缩的能力。</li>
<li>依赖于一系列不显眼的后台任务，执行持续的空间调整和清理。</li>
</ul>
<p>Teradata是以这样的方式架构的：在需要时才为表分配或留出空间。数据行被存储在可变长度的数据块中，它们只有它们需要的那么大。这些数据块可以动态地改变大小，并且移动到柱面上的不同位置或甚至到不同的柱面，而无需手动干预或终端用户的知识。</p>
<p>本节仔细研究了文件系统如何使管理员免于普通的数据放置任务，同时提供了一个友好的环境来改变。</p>
<h3 id="数据如何组织"><a href="#数据如何组织" class="headerlink" title="数据如何组织"></a>数据如何组织</h3><p>Teradata使用一种简单的方案永久地将数据行分配给AMP，该方案适用于数据散列分区的均匀分布。作为最初设计的，DBA选择的列中找到的值是该表的主索引通过散列算法，并产生两个输出（参见图9），通常称为行的“散列”：</p>
<ul>
<li>哈希桶，当应用于预定义的哈希映射时映射到一个AMP</li>
<li>哈希ID，它成为行的唯一“行ID”的一部分。</li>
</ul>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715865.png" alt="图片9"></p>
<p>除了作为一种分布技术之外，这种数据放置的散列方法还可以作为一种索引策略，这减少了设置直接访问行所需的DBA工作量。为了检索行，主索引数据值被传递到散列算法，该算法生成两个散列输出：1.）指向AMP的散列桶;和2.）帮助定位该AMP上的文件系统结构内的行的hashID。在构建主索引或通过其主索引值访问行时没有涉及空间或处理开销，因为不需要构建特殊的索引结构来支持主索引。</p>
<p>散列数据放置非常容易使用，无需设置。DBA所做的唯一努力是选择将构成表的主索引的列。从那时起，该过程完全自动化。</p>
<p>无需分配，分配大小，监视或命名文件。除了在原始CREATE TABLE语句中指定主索引之外，不需要创建DDL。不需要卸载重新载入活动。一旦通过哈希桶识别拥有的AMP，则使用哈希ID来查找磁盘上的行的物理位置。哪个柱面和扇区保持该行是借助于如图10所示的树状三级索引结构来确定的，并且在以下部分中进一步详细解释。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807715913.png" alt="图片10"></p>
<h4 id="主人索引"><a href="#主人索引" class="headerlink" title="主人索引"></a>主人索引</h4><p>主人索引（Master Index,MI）是树状结构的最高级别。 MI的实例驻留在每个AMP上的存储器上。MI按照升序排列该AMP管理的所有柱面，并包含一系列柱面索引描述符。这些描述符包含最低的table-ID和row-ID，以及驻留在每个单独柱面上的数据的最高table-ID和row-ID。每个描述符提供指向该柱面的柱面索引的物理位置的指针。MI还包括在该AMP上可用的自由柱面的列表。</p>
<h4 id="柱面索引"><a href="#柱面索引" class="headerlink" title="柱面索引"></a>柱面索引</h4><p>柱面索引（Cylinder Index,CI）是第二级。与主人索引（MI）相反，柱面索引可以或可以不保持在AMP存储器中。虽然每个AMP仅有一个MI，但是可能存在数千个CI，其中许多可能很少使用。</p>
<p>在物理上，柱面索引是柱面本身的一部分。我们将其视为柱面中的第一个数据块，因为它可以读取到内存中，并像任何其他数据块一样更新。在每个柱面上实际上有两个柱面索引，使得当CI被更新时，另一个版本可用于读取，并且不会发生阻塞。</p>
<p>CI由数据块描述符的排序列表组成 这些数据块描述符保存着每个数据块的第一table-ID和row-ID，块中的行数，其物理位置和长度，以及指示柱面上存在自由空间的空闲块列表。</p>
<h4 id="数据块"><a href="#数据块" class="headerlink" title="数据块"></a>数据块</h4><p>树中的第三级是数据块本身。数据块包含来自同一个表的一系列行。数据块中的行总是按哈希排序。没有为数据块提前分配空间，而是在加载数据或插入新行时动态提供空间。</p>
<p>虽然保持来自一个表的所有数据块在物理上按照柱面的散列排序存在贡献，但是数据块增长以至于超过其最大允许大小和拆分数据块导致这样做有困难。但是因为条目在主人索引和柱面索引中被逻辑地排序，所以即使当与其它数据块物理上不同时，也可以直接访问柱面内的任何数据块。参见图12的示例。</p>
<p>数据块是Teradata文件系统中物理I/O的工作单元。块大小不会被预先设置长度，这减轻了管理员花时间优化存储或调整行大小的需要。但是每个表具有块大小规范，其用作多行数据块的大小的上限。虽然这样可能因版本更新而增加，但是系统将覆盖物理数据块可能大小的最大数据块大小;此最大值至少与允许的最大行大小一样大。管理员可以在逐个表的基础上选择较小的数据块大小作为最大多行数据块大小。</p>
<h3 id="轻松适应数据增长"><a href="#轻松适应数据增长" class="headerlink" title="轻松适应数据增长"></a>轻松适应数据增长</h3><p>Teradata数据库是使用逻辑寻址模型构建的，作为一种低影响的方式来适应数据增长。Teradata系统中的数据存储在通过逻辑到物理索引松散地锚定在一起的大小灵活的数据块中，并且能够根据需要从一个物理磁盘位置浮动到另一个物理磁盘位置。增长超过DBA指定的最大大小的多行数据块会被自动拆分，为更多行腾出空间。如果特定块需要增长超过其在其柱面上的空间，则该块可以移动到相同柱面上的不同位置，或移动到不同柱面上。当这种情况发生时，适当的柱面索引被更新以反映新的物理位置变化。图11可视化地解释了这种行为。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/14880771596.png" alt="图片11"></p>
<p>这种适应性行为带来了许多好处。在它发生的时候适应随机生长。行可以轻松地从一个位置移动到另一个位置，而不会影响正在运行的工作或引用该行的任何其他数据对象。永远不需要停止活动和重新组织物理数据块，或调整指针。</p>
<p>这种随时整合或扩展数据块的灵活性允许Teradata数据块在后台执行许多与空间相关的任务处理，并避免对固定大小的页面数据库通用的表卸载和重载。这个优势增加了数据库可用性，带来更少的DBA的维护任务。</p>
<p>相比固定大小的页方法来存储行。这些行的物理地址只能通过删除和重新插入行来更改，这通常需要将数据库关闭以进行数据重组过程。（Teradata Database未知的概念），这可能会导致性能下降，因为溢出页会为访问和插入行添加额外的I/O。</p>
<h3 id="使用逻辑寻址的表扫描效率"><a href="#使用逻辑寻址的表扫描效率" class="headerlink" title="使用逻辑寻址的表扫描效率"></a>使用逻辑寻址的表扫描效率</h3><p>本节阐述了当查询扫描其数据块随时间变得成熟的表时逻辑寻址如何工作的示例。文件系统尽一切努力保持来自同一表的行在物理上位于同一位置并且在行哈希序列中。但是随着表增长，并且一些块被分割，因为它们变得太大，严格的物理排序并不总是可持续的。这就是逻辑寻址的优点。</p>
<p>在示例（图12）中，第一数据块和第二数据块彼此直接相邻。数据块1没有增长的余地，因此必须拆分成两个较小的数据块，以便容纳新行并仍然保持数据块内的行散列顺序。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807716089.png" alt="图片12"></p>
<p>为了保持顺序的外表，如果逻辑寻址运行的话，文件系统会对数据块内和行之间的行排序施加几个内部约定：</p>
<ol>
<li>数据块只能包含一个表中的行。</li>
<li>存在于给定数据块中的行哈希值或者全部大于或者全部小于在同一表的任何其他数据块上维护的行哈希值。</li>
<li>柱面的柱面索引的关键值或者全部大于或者全部小于在AMP内的任何其他柱面上维持的值。</li>
</ol>
<p>因此，当以行散列顺序扫描表时，一个数据块中的所有行可以在被移动到下一个数据块之前处理完。虽然下一个数据块可能不在物理上与柱面内的当前数据块相邻，但是在移动到下一个柱面之前可以读取一个柱面上的所有数据块。从来没有必要回去读一部分已经完成的柱面。并且不需要指针链来定位逻辑上相邻的数据块。这也意味着当使用称为柱面读取的特殊I/O节省功能时，可以使用单个I/O以正确的顺序处理柱面上的所有数据块。</p>
<h3 id="后台清理任务"><a href="#后台清理任务" class="headerlink" title="后台清理任务"></a>后台清理任务</h3><p>从Teradata数据库的第一个实例起，后台任务就已经发挥了重要作用。数据库连续执行清理任务对用户和DBA透明，例如合并柱面上的小空间自由空间（称为“碎片整理”）。这种内务工作仅在需要时以低优先级完成，以便不影响其他活动工作。因此，通常不需要DBA干预或系统停机时间来保持行组织。</p>
<p>下面的列表展示了一些自我管理任务：</p>
<ul>
<li>碎片整理：合并碎片空间，一次一个柱面 - 更完整的磁盘空间，更多的整理任务将进行。</li>
<li>自动循环打包（AutoCylPack）：组合相邻的，稀疏填充的柱面，当系统空闲时，趋向于运行这些“cylpacks”。</li>
<li>瞬时日志清除：在提交后定期从磁盘中删除事务日志条目，而不是阻止此工作的事务完成。</li>
<li>FSG缓存清除：查找已更新但驻留在FSG缓存中的较旧数据块，并将它们写入磁盘。</li>
</ul>
<h3 id="演化特性-3"><a href="#演化特性-3" class="headerlink" title="演化特性"></a>演化特性</h3><p>在原来的Teradata版本中，每个AMP在其自己的物理磁盘集上逻辑地和物理地拥有和管理自己的数据。随着时间的推移和更高级的磁盘技术的可用性，文件结构组件所看到的数据的逻辑位置及其在磁盘上的实际物理地址变得抽象。逻辑寻址，已经作为关键文件系统方法来适应每天的数据增长，使得这种解耦变得直接。</p>
<p>有助于文件系统虚拟化的最显着的特征之一是称为Teradata虚拟存储（Teradata Virtual Storage，TVS），当它被引入时，通过优化磁盘上的数据放置以加速访问最常用的热数据来提高多路查询能力。在文件系统中，TVS已经承担了磁盘上数据的物理组织/管理的所有责任。例如，使用TVS，根据其访问模式，柱面可能被迁移到不同的物理存储设备。</p>
<p>TVS允许在单个大规模并行处理（MPP）系统内混合驱动器大小和设备类型（例如，机械硬盘和固态硬盘）。如果存在混合设备，则将热数据移动到快速存储，而将冷数据移动到较慢的设备。所有这些重定向地活动都在后台由TVS在后台进行。TVS与Teradata数据库集成，并且具有数据对象感知能力：它能够理解例如临时缓冲文件和用户表数据之间的差异。</p>
<p>这种解耦，磁盘空间管理的虚拟化（如图13所示）使Teradata数据库更具可扩展性和更高性能。它底层建立而不是取代原来的做事方式。DBA仍然在逻辑上定义表，数据库负责分配文件空间以及数据在任何给定时间驻留在何处。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807716133.png" alt="图片13"></p>
<p>除TVS之外的一些功能也是建立在并依赖于原始文件系统架构中，包括：</p>
<ul>
<li>支持行、列或两种方法和动态分区消除的组合的表分区，所有分区行使用相同的原始内部文件系统约定（包括行ID布局）存储和处理。</li>
<li>块级压缩，其中数据块中的所有行都作为一个单元进行压缩。</li>
<li>基于热度的块级压缩（冷压缩），作为块级压缩的扩展，其中只有驻留在不常访问的磁盘上的数据块经历压缩。</li>
<li>没有主索引地表，提供了一种快速方法，用于在跨越哈希分区的AMP之间随机转储数据，非常适合于可变临时表。</li>
</ul>
<h2 id="自动调节工作流"><a href="#自动调节工作流" class="headerlink" title="自动调节工作流"></a>自动调节工作流</h2><p>无共享并行数据库在知道它可以接受多少新工作，以及如何识别开始在一个或多个并行单元中造成的阻塞时具有特殊的挑战。使用优化器尝试对其查看的每个查询应用多维并行性，即使只有少数活动查询，也很容易在Teradata系统中实现非常高的资源利用率。</p>
<p>Teradata数据库专为压力而设计，能够与大量用户，多种多样的工作组合以及完全加载的系统配合使用。依赖于在数据库内建立的内部技术，它能够在极端压力的条件下保持功能完全的油门，以自动和透明地管理工作流，同时系统保持和生产。</p>
<p>即使与Teradata Database配合使用的数据放置约定使它们甚至可以跨AMP放置数据，但是数据并不总是由每个查询都以完美的方式访问。在执行多步骤查询期间，有时某些AMP对于某些步骤需要比其他AMP更多的资源。例如，如果来自航空公司网站的查询基于机场代码执行关联，则可以预期对于亚特兰大（ATL）的行执行联接的AMP需要比加入具有锚定的行的AMP更多的资源（ANC）。</p>
<p>数据库是否继续将工作推向AMP，即使一些AMP无法处理更多？数据库什么时候开始制动并停止向AMP发送新的工作消息？是否需要中央协调员任务来轮询每个AMP的工作级别，然后在更多的工作可以发送或什么时候开始制动时执行？中心协调器任务是在无共享的并行数据库中要避免的事情，因为它变成非并行操作，随着活动、数据库大小或并行性单元数量的增加，它可能成为瓶颈。</p>
<h3 id="AMP级控制"><a href="#AMP级控制" class="headerlink" title="AMP级控制"></a>AMP级控制</h3><p>Teradata数据库管理以高度分散的方式进入系统的工作流，与其无共享体系结构保持一致。没有集中协调员。在AMP之间没有消息传递，以确定是否到了阻止新的请求的时间。相反，每个AMP评估自己承担更多工作的能力，并且当它经历比可以有效处理的更重的负载时被暂时推回。当AMP不得不推回时，它在最短的时间内完成，通常以毫秒为单位。</p>
<p>这种自下而上的工作流控制对于设计的数据库的原始架构是基础的。所有AMP步骤消息传递到AMP，并且每个AMP将决定是开始处理、搁置还是忽略它。这种AMP级别的意义是数据库接受非常高和非常低需求的即兴波动的能力的基石，并且它优雅和不引人注目地管理任何事情。</p>
<p>当它遇到压力时，单个AMP有两种技术可供使用：<br>1.将到达消息放入队列<br>2.拒绝新消息</p>
<p>两种技术为AMP提供了一个短暂的休息时间，允许它在开始新的工作之前专注于完成手头的任务。</p>
<h3 id="将到达消息放入队列"><a href="#将到达消息放入队列" class="headerlink" title="将到达消息放入队列"></a>将到达消息放入队列</h3><p>每个AMP包含一组帮助执行数据库工作的结构。在这些结构中有定义数量的AMP工作任务（AWTs）。每个AMP默认有80个AWTs。</p>
<h4 id="AMP工作任务"><a href="#AMP工作任务" class="headerlink" title="AMP工作任务"></a>AMP工作任务</h4><p>AWTs是每个AMP内部完成数据库工作的任务。该数据库工作可以由内部数据库软件按照历程（例如死锁检测或其他后台任务）启动。或者该工作可以源自用户提交的查询。这些预分配的AWTs在启动时分配给每个AMP，如同在出租车排队等候在机场买票，他们等待工作到达，完成工作，并返回处理更多的工作。</p>
<p>由于它们的无状态条件，AWTs快速响应各种数据库执行需求。每个AMP上有固定数量的AWTs。要使任务开始运行，必须获取可用的AWTs。对每个AMP的AWT的数量具有上限保持在每个AMP内执行数据库工作的活动的数量在合理的水平。 AWTs扮演加速器和调速器的角色。</p>
<p>作为优化过程的一部分，查询被分成一个或多个AMP执行步骤。AMP步骤可以很简单，例如使用唯一的主索引读取一行或应用表级锁。或者AMP步骤可以是非常大的工作块，诸如扫描表，在所读取的行上应用选择标准，重新分布所选择的行以及对重新分布的行进行排序。</p>
<h4 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h4><p>当AMP上的所有AMP工作器任务忙于服务其他查询步骤时，到达的工作消息被放置在驻留在AMP的存储器中的消息队列中。这是一个保持区域，直到AWT释放并且可以服务该消息时。</p>
<p>此队列首先由消息工作类型排序，消息工作类型是指示工作消息的重要性的类别。在工作类型中，队列按照消息来自的请求的优先级排序。开始新工作的消息始终放在消息队列的末尾，遵循Teradata数据库的一个基本哲学：完成已经活动的工作比启动新工作更重要（见图14）。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807716232.png" alt="图片14"></p>
<p>在繁忙的处理期间，有一些AMP用完AWT并开始排队到达消息是正常的。此条件通常是临时的，并且在大多数情况下对用户提交查询是透明的。</p>
<p>表示新查询步骤的消息由调度器广播到所有参与的AMP。在这种情况下，一些AMP可以立即提供AWT，而其他AMP可能必须对消息排队。一些AMP可以使其消息出队，并且比其他的更快地开始在该步骤上工作。这是繁忙系统上的典型行为，其中每个AMP正在管理其自己的工作流。</p>
<p>一旦消息通过动态BYNET组中的每个AMP已经获取了AWT或被接受到消息队列上，则假设每个AMP将最终处理它，即使一些AMP花费比其他AMP更长时间。每个步骤的并行处理的同步点是在步骤完成时，当每个AMP信号通过完成信号量，它已经完成它的一部分。为此目的设置的BYNET通道将在本文的BYNET部分中更全面地讨论。</p>
<h3 id="拒绝新消息"><a href="#拒绝新消息" class="headerlink" title="拒绝新消息"></a>拒绝新消息</h3><p>消息队列是AMP上的第一级回推。然而，在越来越多的消息正在队列上着陆并且越来越少的消息被释放以运行的情况下，消息队列不能不断地扩展。 Teradata Database的流量控制机制比排队工作消息更进一步。</p>
<p>为了节省内存，消息队列的长度将被控制。当排队的消息数量达到阈值时，AMP将转向第二种缓解机制 - 将新到达的消息发送回其源头。</p>
<p>消息有发送方和接收方。在将新步骤发送到AMP的情况下，调度器是发送器，并且一些数量的AMP是接收器。然而，在这种情况下，一个AMP是发送方，另一个AMP或AMP是接收器。</p>
<h4 id="流量控制闸门"><a href="#流量控制闸门" class="headerlink" title="流量控制闸门"></a>流量控制闸门</h4><p>每个AMP具有流控制闸门，用于监视和管理从发送器到达的消息。对于每个不同的消息工作类型，有单独的流控制闸门.新的工作消息将具有它们自己的流控制闸门，如产生的工作消息。流控制门保持该工作类型的活动AWT的计数以及等待AWT的队列中有多少个消息。</p>
<p>一旦某个工作类型的消息队列增长到指定长度，则不再接受该类型的新消息，并且该AMP被称为处于流控制的状态，如图15所示。流控制门将暂时关闭，拉到门外的欢迎地垫上，并且到达消息将被返回给发送者。发送方（通常是PE内的分派器模块）继续重试该消息，直到在该AMP的消息队列上接收到该消息。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807716265.png" alt="图片15"></p>
<h4 id="恢复正常"><a href="#恢复正常" class="headerlink" title="恢复正常"></a>恢复正常</h4><p>因为Teradata数据库是一个消息传递数据库，所以系统架构中有许多不同类型的消息队列。所有这些不同的队列（有时称为“邮箱”）具有对其在任何时间点可容纳的消息的数量设置的限制。它们中的任何一个，包括已经讨论的工作消息队列，如果系统暂时被工作淹没，则可以进入流控制状态。每个AMP独立于每个其他AMP处理这些决定，如图16所示。</p>
<p><img src="http://cgcnm.img48.wal8.com/img48/564134_20161226164230/148807716304.png" alt="图片16"></p>
<p>因为工作消息的接受和拒绝发生在最低级别，在AMP中，当AMP能够恢复到正常的消息传递和处理时，没有层可以通过。 打开和关闭消息流的影响被保持在局部 - 只有在该时间点的过多消息被临时节流的AMP命中。</p>
<h3 id="驾驭满负荷"><a href="#驾驭满负荷" class="headerlink" title="驾驭满负荷"></a>驾驭满负荷</h3><p>Teradata被设计为吞吐量引擎，能够利用并行性以便在只有少数查询处于活动状态时最大化每个请求的资源使用，同时能够在高需求情况下继续生成结果集。为了在极端使用条件下保护整个系统的健康，高度分散的内部控制被纳入基础，如本节所述。</p>
<p>多年来，与流量控制和AMP工作者任务相关的原始架构需要很少的改进甚至调整。每个AMP的80 AWT仍是新Teradata系统的默认设置。消息工作类型，工作消息队列和重试逻辑都与它们总是一样工作。</p>
<p>对于随着时间出现的AMP工作任务，已经有一些扩展，包括：</p>
<ul>
<li>设置专用于战术查询的AWT储备池，保护高优先级的工作不受AWT短缺的影响。</li>
<li>AWT的自动预留池只用于当每个AMP的AWT数量增加到非常高的水平时可用的加载实用程序，旨在减少查询和具有特别高并发性的企业平台的加载作业之间的资源争用。</li>
</ul>
<h2 id="工作负载管理"><a href="#工作负载管理" class="headerlink" title="工作负载管理"></a>工作负载管理</h2><p>本白皮书的第二部分提请注意可用于Teradata Database上的查询的多方面并行性。后续部分讨论了优化程序如何以智能方式使用这些并行机会来提高逐个查询的性能。而前面的部分说明了内部AMP级控制，以保持高水平的用户需求和过度丰富的并行性使系统瘫痪。</p>
<p>除了AMP级别的自动控制外，Teradata始终具有某种类型的系统级工作负载管理，主要是内部数据库例程使用的优先级差异。</p>
<h3 id="原始的四个优先事项"><a href="#原始的四个优先事项" class="headerlink" title="原始的四个优先事项"></a>原始的四个优先事项</h3><p>Teradata数据库的原始架构师面临的挑战之一是如何在平台上支持最高级别的资源使用，并且仍然能够在需要时快速运行内部数据库代码的关键部分。例如，如果由于中止的事务而发生回滚，如果可以快速执行用于清除故障的更新的回滚，则有益于整个系统。</p>
<p>同样重要的是确保在数据库中运行的后台任务没有落后。如果城市街道与汽车交通拥挤，每周的垃圾车不能通过，并且一次延迟几个星期，可能会出现健康危机。</p>
<p>原始架构师发现的解决方案是一个简单的优先级方案，将优先级应用于系统上运行的所有任务。这种基本方法提供了四个优先级桶，每个优先级桶的权重大于前面的值：L代表低，M代表中，H代表高，R代表高峰。默认优先级是中等，而且大多数工作确实在中等，并且被认为对于活动的其他中等优先级工作同等重要。</p>
<p>然而，数据库例程甚至小块代码可以基于工作的重要性来分配其他三个优先级中的一个。例如，开发人员决定为所有END TRANSACTION活动提供紧急优先级，因为以最高速度完成几乎完成的工作可以更快地释放宝贵的资源，并且在数据库中被视为关键。此外，如果管理员希望给优惠的用户更高的优先级，所涉及的是手动将一个优先级标识符添加到用户的帐户字符串中。</p>
<p>关于空间管理一节中讨论的背景任务也是为了使用优先事项。其中一些任务，比如删除不再需要的临时日志行的任务，被设计为以低优先级开始，但是如果系统非常繁忙，他们不能获得他们的工作完成。这种方法在大多数时间在后台保持这样的任务，除非他们需要完成变得至关重要。</p>
<h3 id="混合工作量的影响"><a href="#混合工作量的影响" class="headerlink" title="混合工作量的影响"></a>混合工作量的影响</h3><p>简单的优先级方法是所需的所有内部数据库任务。并且数据库的早期用户满意地以默认中等优先级来运行它们的所有查询。但随着Teradata数据库用户开始使用新类型的更多变化的工作负载来补充传统的决策支持查询，需求随着时间的推移而变化。</p>
<p>在20世纪90年代后期，一些Teradata网站开始向其库存表或其客户数据库等实体发出直接查询查询，同时他们的标准决策支持查询正在运行。呼叫中心开始使用Teradata数据库中的数据来验证客户帐户和最近的互动。战术查询和在线应用程序蓬勃发展，同时更多站点转向连续加载以补充其批处理窗口，使其最终用户更及时地访问最近的活动。服务水平目标是他们的头。需要更强大，更灵活的工作负载管理。</p>
<h3 id="工作负载管理的演变"><a href="#工作负载管理的演变" class="headerlink" title="工作负载管理的演变"></a>工作负载管理的演变</h3><p>虽然工作流的内部管理几乎没有变化，但系统级工作负载管理中的功能已经显着扩大。作为超越原始四个优先级的第一步，Teradata工程开发了一个由多个资源分区和性能组组成的更广泛的优先级调度程序，以及分配自己的自定义权重值的灵活性。这些自定义权重和其他增强功能使控件与业务工作负载和优先级的匹配比为控制内部系统工作设计的原始功能更容易。</p>
<p>多年来发展的其他工作负载管理功能和选项包括：</p>
<ul>
<li>并发控制机制，称为节流，可以放置在多个级别并针对特定类型的查询或用户量身定制。</li>
<li>一个改进的和更有效的优先级调度程序伴随Linux SLES 11操作系统，可以更有效地保护短的，关键的工作从更多资源密集型低优先级作业。</li>
<li>拒绝那些写得不好或不适合在一天中的特定时间运行的查询的规则。</li>
<li>能够根据一天中的时间或系统条件自动更改工作负载设置。</li>
<li>能够自动降低运行的查询的优先级，超过为其当前优先级消耗的资源的阈值。</li>
<li>两个完整的工作负载管理功能集合，称为Teradata主动系统管理和Teradata集成工作负载管理。</li>
<li>一个用户友好的前端GUI，称为Viewpoint Workload Designer，支持轻松设置和调整。</li>
</ul>
<p>Teradata中的工作负载管理已经被证明是快速扩展的领域，对于在Teradata平台上运行各种各样的工作的客户是不可或缺的。虽然内部后台任务和数据库代码子集继续在为它们初始定义的四个不同优先级上运行，但许多Teradata站点发现，他们的最终用户体验更好，并且他们可以通过系统获得更多的工作利用更宽的工作负载管理选择。很多人只是这样。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>基础很重要。如果你还记得三只小猪的童话故事，第一只小猪建了他的稻草房子，第二只小猪建了他的棍子房子，第三只小猪建了他的砖房子。当大坏狼来了，他能够破坏由秸秆和棍子建造的房子，但不能破坏砖建造的房子。所以只有第三只小猪幸存下来，以后永远幸福。</p>
<p>Teradata数据库是一个幸存者。其在新方向上发展并继续保持其核心竞争力的能力是其强大，试验和真实基础的直接结果。多年来，随着Teradata数据库的成熟，一种有趣的模式已经出现，这种模式强调了数据库的不寻常的适应性：逻辑组件及其物理实现已变得越来越分离。</p>
<ul>
<li>在版本号1.1中，每个AMP是一个物理节点，实际拥有自己的磁盘驱动器，并直接管理数据如何位于磁盘上。今天，AMP是一种软件虚拟处理器，它与SMP与其他这样的虚拟处理器共存，所有这些处理器共享节点资源。然而，每个AMP保持它的无共享特性，与第一版相同。</li>
<li>YNet是一个专有的物理互连，支持每个AMP上的位代码。但是今天，Ynet已经发展成为BYNET。由于最近的虚拟化技术，BYNET可以在任何现成的互连硬件上运行，最有利。虽然随着时间的推移已经有很多增强，但是YNet中设计的所有原始可靠性，协调和性能功能保持不变。</li>
<li>主索引，柱面索引和数据块文件系统结构最初被放置到指向AMP的磁盘上的行的实际物理位置。现在底层存储完全由TVS管理，但是相同的索引结构保持在位，以保持逻辑关联的顺序。即使新的功能已经增加了多年，文件系统的基本构建块是相同的。</li>
</ul>
<p>对关键数据库功能的虚拟化的自然演进是重要的，因为它拓宽了Teradata数据库的有用性。对于其大部分历史，Teradata数据库运行在专用硬件上，其中底层平台已经过优化以支持高吞吐量，关键SLA和可靠性。虽然这些优势仍然非常适合企业平台，但这种虚拟化为Teradata数据库开启了便利，可以参与更便携，更低要求的解决方案。例如，公共或私有云架构现在可以享受本白皮书中所述的核心Teradata数据库功能。</p>
<p>本白皮书试图让您熟悉一些构成Teradata数据库的重要构建块的功能，因此您可以自己查看架构的优雅和耐用性。本文指出了最初从这个原始基础发展而来的增强，而不是取代它。</p>
<p>这些基本组件具有这样广泛的后果，即它们根本不能作为事后的想法加以解决。数据库必须与它们一起诞生。</p>

	
	
	
	
</div>

				

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
        <div class="ds-thread" 
            data-thread-key="2017/02/25/生来并行，天生超越——MPP架构原理及实现/" 
            data-url="http://instore.top/2017/02/25/生来并行，天生超越——MPP架构原理及实现/"
            data-title="生来并行，天生超越——MPP架构原理及实现"></div>
    <!-- 多说评论框 end -->
</div>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/02/25/统一数据模型(Unified LDM)介绍/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Liang3p's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        liang3p@gmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="mailto:liang3p@gmail.com" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">3</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">7</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    <a href="https://twitter.com/liang3p" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
        <span class="visuallyhidden">Twitter</span>
    </button></a>
    
    
    <!-- Facebook -->
    
    <a href="https://www.facebook.com/profile.php?id=100011242741015" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
        <span class="visuallyhidden">Facebook</span>
    </button></a>
    
    
    <!-- Google + -->
    
    <a href="https://plus.google.com/115291231508178529929" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
        <span class="visuallyhidden">Google Plus</span>
    </button></a>
    
    
    <!-- Weibo -->
    
    <a href="http://weibo.com/2837545975" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-weibo.png);">
        <span class="visuallyhidden">Weibo</span>
    </button></a>
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;instore.top | Learn More, Share More.</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>






    <!-- Busuanzi -->
    <script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"instore"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->




<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
        var inputArea = document.querySelector("#search");
        var getSearchFile = function(){
            var path = "search.xml";
            searchFunc(path, 'search', 'local-search-result');
        }

        inputArea.onfocus = function(){ getSearchFile() }
	</script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
		
    </body>
		
	
</html>
